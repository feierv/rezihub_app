{% extends '_base.html' %}
{% block content %}
        <div class="auth">
            <div class="auth__left">
                <div class="auth__content">
                    <h1 class="auth__title-stepper">Ce specialitate iti doresti?  ðŸ’¼ </h1>
                    <div id="targetElement"></div>
                    <div id="step-3" class="speciality-select-list">
                        {% for speciality in specialities %}
                            <div class="speciality-card" data-select="{{speciality.name}}">
                            <div class="speciality-card__chip">{{speciality.length}}</div>
                            <img class="speciality-card__image" src="{{speciality.static_url}}" alt="specialitate">
                            <div class="speciality-card__text">{{speciality.name}}</div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            <div class="auth__right">
                <div class="auth__right-wrapper">
                    <div class="auth__right-heading">Lorem ipsum dolor sit amet</div>
                    <div class="auth__right-text">Lorem ipsum dolor sit amet consectetur. Tortor dui vitae proin viverra. Cursus mi vel risus dolor nisi ac in euismod vel gravida mi aliquet sit sit.</div>
                </div>
                <div class="auth__right-image">
                    <img src="/static/assets/images/dashboard-present-min.png" alt="rezihub dashboard">
                </div>
            </div>
        </div>
        <script>
                document.addEventListener("DOMContentLoaded", function () {
                    // Find all elements with the class 'speciality-card'
                    var specialityCards = document.querySelectorAll(".speciality-card");
            
                    // Add a click event listener to each speciality card
                    specialityCards.forEach(function (card) {
                        card.addEventListener("click", function () {
                            // Get the data-select attribute value
                            var dataSelect = card.getAttribute("data-select");
            
                            console.log(dataSelect);
            
                            // Create a new XMLHttpRequest
                            var xhr = new XMLHttpRequest();
            
                            // Define the URL for the GET request
                            var url = "/authentication/get-specialities/?data=" + encodeURIComponent(dataSelect);
            
                            // Configure the request
                            xhr.open("GET", url, true);
                            xhr.setRequestHeader("X-Requested-With", "XMLHttpRequest");
            
                            // Set up the event handler for when the request completes
                            xhr.onload = function () {
                                if (xhr.status >= 200 && xhr.status < 400) {
                                    var responseData = xhr.responseText;

                                    // Get the target element
                                    var targetElement = document.querySelector("#targetElement");

                                    // Set the received HTML as the content of the target element
                                    targetElement.innerHTML = responseData;

                                    // Hide the .speciality-select-list element
                                    var specialitySelectList = document.querySelector(".speciality-select-list");
                                    specialitySelectList.style.display = "none";
                                    var subSpecialityCards = document.querySelectorAll(".sub-speciality-card");
                  
                                    subSpecialityCards.forEach(function (card) {
                                        card.addEventListener("click", function () {
                                            var dataSelect = card.getAttribute("data-select");
                            
                                            // Create a new XHR object
                                            var xhr = new XMLHttpRequest();
                            
                                            // Define the POST request URL
                                            var url = "{% url 'continue-register' %}";
                            
                                            // Set up the request
                                            xhr.open("POST", url);
                                            xhr.setRequestHeader("X-Requested-With", "XMLHttpRequest"); // Set the requested header
                                            xhr.setRequestHeader("X-CSRFToken", "{{ csrf_token }}");
                                            xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                            
                                            // Define the data to be sent
                                            var formData = "specialitate=" + encodeURIComponent(dataSelect);
                            
                                            // Set up the event handler for when the request completes
                                            xhr.onload = function () {
                                                if (xhr.status >= 200 && xhr.status < 400) {
                                                    // Handle success
                                                    console.log("POST request successful");
                                                    var responseData = xhr.responseText; // Get the response data
                                                    document.body.innerHTML = responseData;
                                                } else {
                                                    // Handle error
                                                    console.error("Error:", xhr.statusText);
                                                }
                                            };
                            
                                            // Set up the event handler for network errors
                                            xhr.onerror = function () {
                                                console.error("Network error occurred");
                                            };
                            
                                            // Send the request
                                            xhr.send(formData);
                                        });
                                    });
                                } else {
                                    console.error("Error:", xhr.statusText);
                                }
                            };
            
                            // Set up the event handler for errors
                            xhr.onerror = function () {
                                console.error("Request failed");
                            };
            
                            // Send the request
                            xhr.send();
                        });
                    });
                });
            </script>
{% endblock %}
